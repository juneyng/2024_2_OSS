<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <style>
      /* 폼 너비 조절 */
      .form-container {
        width: 50%;
        margin: 0 auto;
      }

      /* 유효하지 않은 필드에 빨간 테두리 적용 */
      .is-invalid {
        border: 2px solid red !important;
      }

      /* 유효한 필드에 초록 테두리 적용 */
      .is-valid {
        border: 2px solid green !important;
      }

      /* 경고 메시지 스타일 */
      .invalid-feedback,
      .valid-feedback {
        display: none;
      }

      /* 유효하지 않은 경우 경고 메시지 표시 */
      .is-invalid + .invalid-feedback {
        display: block;
      }

      /* 유효한 경우 성공 메시지 표시 */
      .is-valid + .valid-feedback {
        display: block;
      }
    </style>
    <title>Add Page</title>
  </head>
  <body>
    <header>
      <!--Header Part-->
      <div class="px-3 py-2 text-bg-dark border-bottom">
        <div class="container">
          <div
            class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start"
          >
            <a
              href="https://22100566-assignment2-2.netlify.app/index/index.html"
              class="d-flex align-items-center my-2 my-lg-0 me-lg-auto text-white text-decoration-none"
            >
              </svg>
              운동 기록 관리
            </a>

            <ul
              class="nav col-12 col-lg-auto my-2 justify-content-center my-md-0 text-small"
            >
              <li>
                <a
                  href="https://22100566-assignment2-2.netlify.app/index/index.html"
                  class="nav-link text-white rounded"
                >
                  Home
                </a>
              </li>
              <li>
                <a
                  href="https://22100566-assignment2-2.netlify.app/add/add.html"
                  class="nav-link text-white rounded"
                >
                  Add page
                </a>
              </li>
              <li>
                <a
                  href="https://22100566-assignment2-2.netlify.app/edit/edit.html"
                  class="nav-link text-white bg-primary rounded"
                >
                  Edit page
                </a>
              </li>
              <li>
                <a
                  href="https://22100566-assignment2-2.netlify.app/view/view.html"
                  class="nav-link text-white rounded"
                >
                  View Page
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </header>

    <!-- Form Section -->
    <div class="container my-4 form-container">
      <h2>운동 기록 추가</h2>
      <form id="exerciseForm" novalidate>
        <!-- 기본 HTML5 validation 제거 -->
        <!-- 운동 강도 -->
        <div class="mb-3">
          <label for="intensity" class="form-label">운동 강도</label>
          <select class="form-select" id="intensity" required>
            <option value="*">1</option>
            <option value="**">2</option>
            <option value="***" selected>3</option>
          </select>
          <div class="invalid-feedback">운동 강도를 선택하세요.</div>
          <div class="valid-feedback">올바르게 입력되었습니다.</div>
        </div>

        <!-- 운동명 -->
        <div class="mb-3">
          <label for="exerciseName" class="form-label">운동명</label>
          <input
            type="text"
            class="form-control"
            id="exerciseName"
            value="달리기"
            required
          />
          <div class="invalid-feedback">운동명을 입력하세요.</div>
          <div class="valid-feedback">올바르게 입력되었습니다.</div>
        </div>

        <!-- 장소 -->
        <div class="mb-3">
          <label for="location" class="form-label">장소</label>
          <input
            type="text"
            class="form-control"
            id="location"
            value="운동장"
            required
          />
          <div class="invalid-feedback">장소를 입력하세요.</div>
          <div class="valid-feedback">올바르게 입력되었습니다.</div>
        </div>

        <!-- 일자 -->
        <div class="mb-3">
          <label for="date" class="form-label">일자</label>
          <input type="date" class="form-control" id="date" value="2024-09-28" required />
          <div class="invalid-feedback">날짜를 선택하세요.</div>
          <div class="valid-feedback">올바르게 입력되었습니다.</div>
        </div>

        <!-- 운동 시간 -->
        <div class="mb-3">
          <label for="duration-start" class="form-label">운동 시작 시간</label>
          <input
            type="time"
            step="2"
            class="form-control"
            id="duration-start"
            value="07:30"
            required
          />
          <div class="invalid-feedback">운동 시간을 입력하세요.</div>
          <div class="valid-feedback">올바르게 입력되었습니다.</div>
        </div>

        <!-- 운동 시간 -->
        <div class="mb-3">
          <label for="duration-end" class="form-label">운동 종료 시간</label>
          <input
            type="time"
            step="2"
            class="form-control"
            id="duration-end"
            value="08:30"
            required
          />
          <div class="invalid-feedback">운동 시간을 입력하세요.</div>
          <div class="valid-feedback">올바르게 입력되었습니다.</div>
        </div>

        <!-- 제출 버튼 -->
        <button type="submit" class="btn btn-primary">운동 기록 수정</button>
      </form>
    </div>
    <footer class="text-center mt-5">
      <hr>
      <p class="text-muted small">22100566 이준영 Assignment2-2</p>
    </footer>
    <script>
      // 유효성 검사 함수: 값을 입력할 때마다 즉시 검사
      const validateField = (id) => {
        const field = document.getElementById(id);
        field.addEventListener("input", () => {
          if (!field.value.trim()) {
            field.classList.remove("is-valid");
            field.classList.add("is-invalid");
          } else {
            field.classList.remove("is-invalid");
            field.classList.add("is-valid");
          }
        });
      };

      // 각 필드에 대해 즉시 유효성 검사를 적용
      validateField("intensity");
      validateField("exerciseName");
      validateField("location");
      validateField("date");
      validateField("duration-start");
      validateField("duration-end");

      // 폼 제출 시 이벤트 핸들러
      document
        .getElementById("exerciseForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          let isValid = true;

          // 제출 시에도 한번 더 검증
          const checkField = (id) => {
            const field = document.getElementById(id);
            if (!field.value.trim()) {
              field.classList.remove("is-valid");
              field.classList.add("is-invalid");
              isValid = false;
            } else {
              field.classList.remove("is-invalid");
              field.classList.add("is-valid");
            }
          };

          // 제출할 때 모든 필드 재검사
          checkField("intensity");
          checkField("exerciseName");
          checkField("location");
          checkField("date");
          checkField("duration-start");
          checkField("duration-end");

          // 모든 필드가 유효하면 confirm 과정을 통해 제출 여부 확인
          if (isValid) {
            const confirmed = confirm("게시물을 수정할까요?");
            if (confirmed) {
              // 확인을 누른 경우 게시물을 추가하고 알림 출력
              const intensity = document.getElementById("intensity").value;
              const exerciseName =
                document.getElementById("exerciseName").value;
              const location = document.getElementById("location").value;
              const date = document.getElementById("date").value;
              const duration_start =
                document.getElementById("duration-start").value;
              const duration_end =
                document.getElementById("duration-end").value;

              const newRecord = {
                intensity,
                exerciseName,
                location,
                date,
                duration_start,
                duration_end,
              };

              let exerciseData =
                JSON.parse(localStorage.getItem("exerciseData")) || [];
              exerciseData.push(newRecord);
              localStorage.setItem(
                "exerciseData",
                JSON.stringify(exerciseData)
              );

              alert("게시물이 수정됩니다.");
              window.location.href = "https://22100566-assignment2-2.netlify.app/index/index.html"; // index.html로 돌아감
            } else {
              // 취소를 누른 경우 바로 index.html로 돌아감
              window.location.href = "https://22100566-assignment2-2.netlify.app/index.html";
            }
          }
        });
    </script>
  </body>
</html>
